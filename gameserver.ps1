using namespace System.Collections.Generic
using namespace System.Text
using namespace System.Net
using namespace System.Net.Sockets
using namespace System.IO
using namespace System

function Read-Full {
    param([Stream]$stream, [byte[]]$buffer, [int]$count)

    $offset = 0
    while ($offset -lt $count) {
        $r = $stream.Read($buffer, $offset, $count - $offset)
        if ($r -le 0) { throw "connection closed" }
        $offset += $r
    }
}

function read_u16_be([byte[]]$b) {
    return ([uint16]$b[0] -shl 8) -bor $b[1]
}

function read_u32_be([byte[]]$b) {
    return ([uint32]$b[0] -shl 24) -bor
    ([uint32]$b[1] -shl 16) -bor
    ([uint32]$b[2] -shl 8) -bor
    $b[3]
}

function write_u16_be([uint16]$v) {
    return [byte[]]@(
        ($v -shr 8) -band 0xFF
        $v -band 0xFF
    )
}

function write_u32_be([uint32]$v) {
    return [byte[]]@(
        ($v -shr 24) -band 0xFF
        ($v -shr 16) -band 0xFF
        ($v -shr 8) -band 0xFF
        $v -band 0xFF
    )
}

class Packet {
    [uint16] $cmd
    [byte[]] $head
    [byte[]] $body

    hidden static [byte[]] $head_magic = [byte[]](0x9D, 0x74, 0xC7, 0x14)
    hidden static [byte[]] $tail_magic = [byte[]](0xD7, 0xA1, 0x52, 0xC8)

    Packet([uint16]$cmd, [byte[]]$head, [byte[]]$body) {
        $this.cmd = $cmd
        $this.head = $head
        $this.body = $body
    }

    static [Packet] read_packet([Stream]$stream) {
        $header = New-Object byte[] 12
        Read-Full $stream $header 12

        for ($i = 0; $i -lt 4; $i++) {
            if ($header[$i] -ne [Packet]::head_magic[$i]) {
                throw "invalid head magic"
            }
        }

        $ccmd = read_u16_be $header[4..5]
        $head_len = read_u16_be $header[6..7]
        $body_len = read_u32_be $header[8..11]

        $hhead = New-Object byte[] $head_len
        if ($head_len -gt 0) {
            Read-Full $stream $hhead $head_len
        }

        $bbody = New-Object byte[] $body_len
        if ($body_len -gt 0) {
            Read-Full $stream $bbody $body_len
        }

        $tail = New-Object byte[] 4
        Read-Full $stream $tail 4

        for ($i = 0; $i -lt 4; $i++) {
            if ($tail[$i] -ne [Packet]::tail_magic[$i]) {
                throw "invalid tail magic"
            }
        }

        return [Packet]::new($ccmd, $hhead, $bbody)
    }

    [byte[]] encode() {
        $head_len = [uint16]$this.head.Length
        $body_len = [uint32]$this.body.Length

        $total = 4 + 2 + 2 + 4 + $head_len + $body_len + 4
        $packet = New-Object byte[] $total
        $offset = 0

        [Array]::Copy([Packet]::head_magic, 0, $packet, $offset, 4)
        $offset += 4

        $cmd_be = write_u16_be $this.cmd
        [Array]::Copy($cmd_be, 0, $packet, $offset, 2)
        $offset += 2

        $hl_be = write_u16_be $head_len
        [Array]::Copy($hl_be, 0, $packet, $offset, 2)
        $offset += 2

        $bl_be = write_u32_be $body_len
        [Array]::Copy($bl_be, 0, $packet, $offset, 4)
        $offset += 4

        if ($head_len -gt 0) {
            [Array]::Copy($this.head, 0, $packet, $offset, $head_len)
            $offset += $head_len
        }

        if ($body_len -gt 0) {
            [Array]::Copy($this.body, 0, $packet, $offset, $body_len)
            $offset += $body_len
        }

        [Array]::Copy([Packet]::tail_magic, 0, $packet, $offset, 4)

        return $packet
    }
}

$FieldNums = [Dictionary[string, int32]]::new()

$FieldNumsPath = "fieldnums.txt"
if (-not (Test-Path $FieldNumsPath)) {
    Write-Error "File not found: $FieldNumsPath"
    return
}
foreach ($line in Get-Content $FieldNumsPath) {
    $line = $line.Trim()
    if ($line -eq "" -or $line.StartsWith("#") -or $line.StartsWith("//")) {
        continue
    }
    $parts = $line -split "="
    if ($parts.Count -ne 2) {
        continue
    }
    $key = $parts[0].Trim()
    $value = [int32]($parts[1].Trim())
    $FieldNums[$key] = $value
}

function Get-FieldNum {
    param([string] $Key)

    if (-not $FieldNums.ContainsKey($Key)) {
        throw "$Key not found in fieldnums"
    }

    return $FieldNums[$Key]
}

class ProtoWriter {
    [List[byte]] $Buffer
    [HashSet[Int32]] $UsedFields

    ProtoWriter() {
        $this.Buffer = [List[byte]]::new()
        $this.UsedFields = [HashSet[Int32]]::new()
    }

    hidden [void] AddByte([byte] $b) {
        $this.Buffer.Add($b)
    }

    hidden [void] AddBytes([byte[]] $bytes) {
        foreach ($b in $bytes) {
            $this.Buffer.Add($b)
        }
    }

    hidden [void] WriteVarint([UInt64] $value) {
        while ($value -gt 0x7F) {
            $this.AddByte([byte](0x80 -bor ($value -band 0x7F)))
            $value = $value -shr 7
        }
        $this.AddByte([byte]$value)
    }

    hidden [void] CheckField([Int32] $fieldNumber, [Int32] $wireType, [bool] $allowRepeated) {
        if (-not $allowRepeated -and $this.UsedFields.Contains($fieldNumber)) {
            throw "$fieldNumber already written && !repeated"
        }
        $this.UsedFields.Add($fieldNumber) | Out-Null
        $tag = ($fieldNumber -shl 3) -bor $wireType
        $this.WriteVarint([UInt64]$tag)
    }

    [void] WriteUInt64([Int32] $fieldNumber, [UInt64] $value, [bool] $repeated) {
        $this.CheckField($fieldNumber, 0, $repeated)
        $this.WriteVarint($value)
    }

    [void] WriteUInt32([Int32] $fieldNumber, [UInt32] $value, [bool] $repeated) {
        $this.CheckField($fieldNumber, 0, $repeated)
        $this.WriteVarint([UInt64]$value)
    }

    [void] WriteBool([Int32] $fieldNumber, [bool] $value, [bool] $repeated) {
        $this.CheckField($fieldNumber, 0, $repeated)
        $this.WriteVarint($(if ($value) { 1 } else { 0 }))
    }

    [void] WriteString([Int32] $fieldNumber, [string] $value, [bool] $repeated) {
        $this.CheckField($fieldNumber, 2, $repeated)
        $bytes = [Encoding]::UTF8.GetBytes($value)
        $this.WriteVarint([UInt64]$bytes.Length)
        $this.AddBytes($bytes)
    }

    [void] WriteMessage([Int32] $fieldNumber, [byte[]] $msgBytes, [bool] $repeated) {
        $this.CheckField($fieldNumber, 2, $repeated)
        $this.WriteVarint([UInt64]$msgBytes.Length)
        $this.AddBytes($msgBytes)
    }

    [byte[]] GetBytes() {
        return $this.Buffer.ToArray()
    }
}

$DummyMap = [Dictionary[int32, int32]]::new()
$DummyMap[ (Get-FieldNum "CmdId.GetLevelRewardTakenListCsReq") ] = (Get-FieldNum "CmdId.GetLevelRewardTakenListScRsp")
$DummyMap[ (Get-FieldNum "CmdId.QueryProductInfoCsReq") ] = (Get-FieldNum "CmdId.QueryProductInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetQuestDataCsReq") ] = (Get-FieldNum "CmdId.GetQuestDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetQuestRecordCsReq") ] = (Get-FieldNum "CmdId.GetQuestRecordScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetCurAssistCsReq") ] = (Get-FieldNum "CmdId.GetCurAssistScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetDailyActiveInfoCsReq") ] = (Get-FieldNum "CmdId.GetDailyActiveInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetFightActivityDataCsReq") ] = (Get-FieldNum "CmdId.GetFightActivityDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetShareDataCsReq") ] = (Get-FieldNum "CmdId.GetShareDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetTreasureDungeonActivityDataCsReq") ] = (Get-FieldNum "CmdId.GetTreasureDungeonActivityDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetPlayerBoardDataCsReq") ] = (Get-FieldNum "CmdId.GetPlayerBoardDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetActivityScheduleConfigCsReq") ] = (Get-FieldNum "CmdId.GetActivityScheduleConfigScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetMissionDataCsReq") ] = (Get-FieldNum "CmdId.GetMissionDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetChallengeCsReq") ] = (Get-FieldNum "CmdId.GetChallengeScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetCurChallengeCsReq") ] = (Get-FieldNum "CmdId.GetCurChallengeScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetExpeditionDataCsReq") ] = (Get-FieldNum "CmdId.GetExpeditionDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetJukeboxDataCsReq") ] = (Get-FieldNum "CmdId.GetJukeboxDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.SyncClientResVersionCsReq") ] = (Get-FieldNum "CmdId.SyncClientResVersionScRsp")
$DummyMap[ (Get-FieldNum "CmdId.DailyFirstMeetPamCsReq") ] = (Get-FieldNum "CmdId.DailyFirstMeetPamScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetLoginActivityCsReq") ] = (Get-FieldNum "CmdId.GetLoginActivityScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetRaidInfoCsReq") ] = (Get-FieldNum "CmdId.GetRaidInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetTrialActivityDataCsReq") ] = (Get-FieldNum "CmdId.GetTrialActivityDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetNpcStatusCsReq") ] = (Get-FieldNum "CmdId.GetNpcStatusScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetSecretKeyInfoCsReq") ] = (Get-FieldNum "CmdId.GetSecretKeyInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetVideoVersionKeyCsReq") ] = (Get-FieldNum "CmdId.GetVideoVersionKeyScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetCurBattleInfoCsReq") ] = (Get-FieldNum "CmdId.GetCurBattleInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetPhoneDataCsReq") ] = (Get-FieldNum "CmdId.GetPhoneDataScRsp")
$DummyMap[ (Get-FieldNum "CmdId.InteractPropCsReq") ] = (Get-FieldNum "CmdId.InteractPropScRsp")
$DummyMap[ (Get-FieldNum "CmdId.FinishTalkMissionCsReq") ] = (Get-FieldNum "CmdId.FinishTalkMissionScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetRechargeGiftInfoCsReq") ] = (Get-FieldNum "CmdId.GetRechargeGiftInfoScRsp")
$DummyMap[ (Get-FieldNum "CmdId.GetBagCsReq") ] = (Get-FieldNum "CmdId.GetBagScRsp")
$DummyMap[ (Get-FieldNum "CmdId.PlayerLoginFinishCsReq") ] = (Get-FieldNum "CmdId.PlayerLoginFinishScRsp")
$DummyMap[ (Get-FieldNum "CmdId.SceneEntityMoveCsReq") ] = (Get-FieldNum "CmdId.SceneEntityMoveScRsp")

class Avatar {
    static [int] $FIELD_unk_enhanced_id
    static [int] $FIELD_promotion
    static [int] $FIELD_level
    static [int] $FIELD_rank
    static [int] $FIELD_base_avatar_id
    static [int] $FIELD_first_met_time_stamp

    static InitFieldNum() {
        [Avatar]::FIELD_unk_enhanced_id = Get-FieldNum "Avatar.unk_enhanced_id"
        [Avatar]::FIELD_promotion = Get-FieldNum "Avatar.promotion"
        [Avatar]::FIELD_level = Get-FieldNum "Avatar.level"
        [Avatar]::FIELD_rank = Get-FieldNum "Avatar.rank"
        [Avatar]::FIELD_base_avatar_id = Get-FieldNum "Avatar.base_avatar_id"
        [Avatar]::FIELD_first_met_time_stamp = Get-FieldNum "Avatar.first_met_time_stamp"
    }

    [uint32] $unk_enhanced_id
    [uint32] $promotion
    [uint32] $level
    [uint32] $rank
    [uint32] $base_avatar_id
    [uint64] $first_met_time_stamp

    Avatar() { }

    [byte[]] Encode() {
        $w = [ProtoWriter]::new()

        if ($this.unk_enhanced_id) { $w.WriteUInt32([Avatar]::FIELD_unk_enhanced_id, $this.unk_enhanced_id, $false) }
        if ($this.promotion) { $w.WriteUInt32([Avatar]::FIELD_promotion, $this.promotion, $false) }
        if ($this.level) { $w.WriteUInt32([Avatar]::FIELD_level, $this.level, $false) }
        if ($this.rank) { $w.WriteUInt32([Avatar]::FIELD_rank, $this.rank, $false) }
        if ($this.base_avatar_id) { $w.WriteUInt32([Avatar]::FIELD_base_avatar_id, $this.base_avatar_id, $false) }
        if ($this.first_met_time_stamp) { $w.WriteUInt64([Avatar]::FIELD_first_met_time_stamp, $this.first_met_time_stamp, $false) }

        return $w.GetBytes()
    }
}
[Avatar]::InitFieldNum()

class GetAvatarDataScRsp {
    static [int] $FIELD_avatar_list
    static [int] $FIELD_is_get_all

    static InitFieldNum() {
        [GetAvatarDataScRsp]::FIELD_avatar_list = Get-FieldNum "GetAvatarDataScRsp.avatar_list"
        [GetAvatarDataScRsp]::FIELD_is_get_all = Get-FieldNum "GetAvatarDataScRsp.is_get_all"
    }

    [List[Avatar]] $avatar_list
    [bool] $is_get_all

    GetAvatarDataScRsp() { }

    [byte[]] Encode() {
        $w = [ProtoWriter]::new()
        if ($this.avatar_list) {
            foreach ($avatar in $this.avatar_list) {
                $bytes = $avatar.Encode()
                $w.WriteMessage([GetAvatarDataScRsp]::FIELD_avatar_list, $bytes, $true)
            }
        }
        if ($this.is_get_all) { $w.WriteBool([GetAvatarDataScRsp]::FIELD_is_get_all, $this.is_get_all, $false) }
        return $w.GetBytes()
    }
}
[GetAvatarDataScRsp]::InitFieldNum()

function Write-PacketResponse {
    param(
        [pscustomobject] $ctx,
        [uint16] $cmd_id,
        [byte[]] $body
    )

    $resp = [Packet]::new($cmd_id, [byte[]]@(), $body)
    $encoded = $resp.encode()
    $ctx.stream.Write($encoded, 0, $encoded.Length)
}

function Write-RawResponse {
    param(
        [pscustomobject] $ctx,
        [byte[]] $bytes
    )

    $ctx.stream.Write($bytes, 0, $bytes.Length)
}

$HandlerMap = @{}

$HandlerMap[[uint16](Get-FieldNum "CmdId.GetAvatarDataCsReq")] = {
    param([pscustomobject] $ctx)

    $rsp = [GetAvatarDataScRsp]::new()
    $rsp.is_get_all = $true
    $rsp.avatar_list = [List[Avatar]]::new()

    $av = [Avatar]::new()
    $av.base_avatar_id = 1201
    $av.unk_enhanced_id = 0
    $av.promotion = 6
    $av.level = 80
    $av.rank = 6
    $av.first_met_time_stamp = [uint64]([DateTimeOffset]::UtcNow.ToUnixTimeMilliseconds())

    $rsp.avatar_list.Add($av)

    Write-PacketResponse $ctx (Get-FieldNum "CmdId.GetAvatarDataScRsp") ($rsp.Encode())
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.GetAllLineupDataCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,2,250,0,0,0,0,0,31,42,29,26,16,16,177,9,24,3,48,144,78,74,6,8,144,78,16,144,78,42,9,81,105,110,103,113,117,101,83,82,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.GetCurLineupDataCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,2,205,0,0,0,0,0,31,50,29,26,16,16,177,9,24,3,48,144,78,74,6,8,144,78,16,144,78,42,9,81,105,110,103,113,117,101,83,82,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$global:MissionStatusIndex = 0
$MissionStatusResponses = @(
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,6,18,10,9,16,2,32,1,120,155,202,218,47,10,9,16,2,32,1,120,248,153,210,48,10,9,16,2,32,1,120,249,153,210,48,10,9,16,2,32,1,120,250,153,210,48,10,9,16,2,32,1,120,251,153,210,48,10,9,16,2,32,1,120,252,153,210,48,10,9,16,2,32,1,120,253,153,210,48,10,9,16,2,32,1,120,254,153,210,48,10,9,16,2,32,1,120,255,153,210,48,10,9,16,2,32,1,120,128,154,210,48,10,10,16,2,32,1,120,246,151,212,192,1,10,9,16,2,32,1,120,133,161,176,95,10,9,16,2,32,1,120,143,220,157,48,10,9,16,2,32,1,120,230,203,218,47,10,9,16,2,32,1,120,231,203,218,47,10,9,16,2,32,1,120,232,203,218,47,10,10,16,2,32,1,120,133,178,136,159,2,10,9,16,2,32,1,120,155,157,245,95,10,9,16,2,32,1,120,159,157,245,95,10,9,16,2,32,1,120,229,203,218,47,10,9,16,2,32,1,120,170,199,148,48,10,9,16,2,32,1,120,142,200,148,48,10,9,16,2,32,1,120,139,200,148,48,10,9,16,2,32,1,120,140,200,148,48,10,10,16,2,32,1,120,202,222,155,191,1,10,10,16,2,32,1,120,203,222,155,191,1,10,10,16,2,32,1,120,227,222,155,191,1,10,10,16,2,32,1,120,205,222,155,191,1,10,10,16,2,32,1,120,199,222,155,191,1,10,10,16,2,32,1,120,201,222,155,191,1,10,10,16,2,32,1,120,206,222,155,191,1,10,10,16,2,32,1,120,129,223,155,191,1,10,10,16,2,32,1,120,131,223,155,191,1,10,10,16,2,32,1,120,133,223,155,191,1,10,10,16,2,32,1,120,200,222,155,191,1,10,10,16,2,32,1,120,225,164,143,193,1,10,10,16,2,32,1,120,226,164,143,193,1,10,10,16,2,32,1,120,227,164,143,193,1,10,10,16,2,32,1,120,197,165,143,193,1,10,10,16,2,32,1,120,169,166,143,193,1,10,10,16,2,32,1,120,141,167,143,193,1,10,10,16,2,32,1,120,142,167,143,193,1,10,10,16,2,32,1,120,143,167,143,193,1,10,10,16,2,32,1,120,144,167,143,193,1,10,10,16,2,32,1,120,145,167,143,193,1,10,10,16,2,32,1,120,241,167,143,193,1,10,10,16,2,32,1,120,242,167,143,193,1,10,10,16,2,32,1,120,243,167,143,193,1,10,10,16,2,32,1,120,244,167,143,193,1,10,10,16,2,32,1,120,189,176,143,193,1,10,10,16,2,32,1,120,190,176,143,193,1,10,10,16,2,32,1,120,191,176,143,193,1,10,10,16,2,32,1,120,192,176,143,193,1,10,10,16,2,32,1,120,193,176,143,193,1,10,10,16,2,32,1,120,161,177,143,193,1,10,10,16,2,32,1,120,133,178,143,193,1,10,10,16,2,32,1,120,134,178,143,193,1,10,10,16,2,32,1,120,233,178,143,193,1,10,10,16,2,32,1,120,234,178,143,193,1,10,10,16,2,32,1,120,205,179,143,193,1,10,10,16,2,32,1,120,206,179,143,193,1,10,10,16,2,32,1,120,207,179,143,193,1,10,10,16,2,32,1,120,182,162,143,193,1,10,10,16,2,32,1,120,254,163,143,193,1,10,10,16,2,32,1,120,213,168,143,193,1,10,10,16,2,32,1,120,215,168,143,193,1,10,10,16,2,32,1,120,185,169,143,193,1,10,10,16,2,32,1,120,189,169,143,193,1,10,10,16,2,32,1,120,157,170,143,193,1,10,10,16,2,32,1,120,158,170,143,193,1,10,10,16,2,32,1,120,129,171,143,193,1,10,10,16,2,32,1,120,229,171,143,193,1,10,10,16,2,32,1,120,201,172,143,193,1,10,10,16,2,32,1,120,173,173,143,193,1,10,10,16,2,32,1,120,145,174,143,193,1,10,10,16,2,32,1,120,147,174,143,193,1,10,10,16,2,32,1,120,245,174,143,193,1,10,10,16,2,32,1,120,246,174,143,193,1,10,10,16,2,32,1,120,217,175,143,193,1,10,10,16,2,32,1,120,218,175,143,193,1,10,10,16,2,32,1,120,177,180,143,193,1,10,10,16,2,32,1,120,179,180,143,193,1,10,10,16,2,32,1,120,149,181,143,193,1,10,10,16,2,32,1,120,249,181,143,193,1,10,10,16,2,32,1,120,221,182,143,193,1,10,10,16,2,32,1,120,193,183,143,193,1,10,10,16,2,32,1,120,165,184,143,193,1,10,10,16,2,32,1,120,137,185,143,193,1,10,10,16,2,32,1,120,237,185,143,193,1,10,10,16,2,32,1,120,209,186,143,193,1,10,10,16,2,32,1,120,181,187,143,193,1,10,10,16,2,32,1,120,194,187,143,193,1,10,10,16,2,32,1,120,153,188,143,193,1,10,10,16,2,32,1,120,253,188,143,193,1,10,10,16,2,32,1,120,154,188,143,193,1,10,9,16,2,32,1,120,235,252,219,48,10,9,16,2,32,1,120,199,165,237,95,10,9,16,2,32,1,120,148,220,157,48,10,9,16,2,32,1,120,149,220,157,48,10,9,16,2,32,1,120,150,220,157,48,10,9,16,2,32,1,120,151,220,157,48,10,9,16,2,32,1,120,133,155,175,96,10,9,16,2,32,1,120,137,155,175,96,10,9,16,2,32,1,120,136,155,175,96,10,10,16,2,32,1,120,141,224,155,191,1,10,9,16,2,32,1,120,197,165,237,95,10,9,16,2,32,1,120,200,165,237,95,10,9,16,2,32,1,120,232,245,179,95,10,9,16,2,32,1,120,161,202,218,47,10,9,16,2,32,1,120,175,202,218,47,10,9,16,2,32,1,120,176,202,218,47,10,9,16,2,32,1,120,142,153,172,96,10,9,16,2,32,1,120,198,165,237,95,10,9,16,2,32,1,120,225,165,237,95,10,9,16,2,32,1,120,134,155,175,96,10,9,16,2,32,1,120,135,155,175,96,18,201,1,209,210,61,165,133,61,182,136,61,210,210,61,181,136,61,183,136,61,184,136,61,249,224,244,1,216,152,247,1,217,152,247,1,218,152,247,1,219,152,247,1,220,152,247,1,231,152,247,1,232,152,247,1,233,152,247,1,234,152,247,1,235,152,247,1,213,152,247,1,215,152,247,1,203,221,61,221,152,247,1,222,152,247,1,223,152,247,1,224,152,247,1,225,152,247,1,226,152,247,1,227,152,247,1,228,152,247,1,229,152,247,1,230,152,247,1,244,152,247,1,245,152,247,1,236,152,247,1,237,152,247,1,238,152,247,1,239,152,247,1,240,152,247,1,241,152,247,1,242,152,247,1,243,152,247,1,197,161,62,133,205,246,1,201,138,122,233,184,239,2,237,226,122,149,225,244,1,246,152,247,1,247,152,247,1,217,216,122,137,173,123,251,224,244,1,161,143,122,155,169,123,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,0,5,18,3,237,134,61,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,0,5,18,3,190,136,61,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,0,0,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,15,50,10,9,16,2,32,1,120,220,171,149,49,10,9,16,2,32,1,120,135,172,149,49,10,9,16,2,32,1,120,140,172,149,49,10,9,16,2,32,1,120,147,172,149,49,10,9,16,2,32,1,120,213,171,149,49,10,9,16,2,32,1,120,158,172,149,49,10,9,16,2,32,1,120,139,172,149,49,10,9,16,2,32,1,120,136,172,149,49,10,9,16,2,32,1,120,133,150,151,49,10,9,16,2,32,1,120,143,150,151,49,10,9,16,2,32,1,120,251,199,150,49,10,9,16,2,32,1,120,166,178,152,49,10,9,16,2,32,1,120,184,178,152,49,10,9,16,2,32,1,120,176,228,151,49,10,9,16,2,32,1,120,182,128,153,49,10,9,16,2,32,1,120,240,128,153,49,10,9,16,2,32,1,120,197,191,158,49,10,9,16,2,32,1,120,198,191,158,49,10,9,16,2,32,1,120,170,192,158,49,10,9,16,2,32,1,120,171,192,158,49,10,9,16,2,32,1,120,181,192,158,49,10,9,16,2,32,1,120,249,213,156,49,10,9,16,2,32,1,120,252,213,156,49,10,9,16,2,32,1,120,253,212,167,49,10,9,16,2,32,1,120,254,212,167,49,10,9,16,2,32,1,120,197,214,167,49,10,9,16,2,32,1,120,198,214,167,49,10,9,16,2,32,1,120,141,216,167,49,10,9,16,2,32,1,120,168,216,167,49,10,9,16,2,32,1,120,182,246,181,96,10,9,16,2,32,1,120,190,246,181,96,10,9,16,2,32,1,120,239,248,181,96,10,9,16,2,32,1,120,246,248,181,96,10,9,16,2,32,1,120,169,197,182,96,10,9,16,2,32,1,120,173,197,182,96,10,9,16,2,32,1,120,141,198,182,96,10,9,16,2,32,1,120,151,198,182,96,10,9,16,2,32,1,120,213,199,182,96,10,9,16,2,32,1,120,221,199,182,96,10,9,16,2,32,1,120,213,146,183,96,10,9,16,2,32,1,120,219,146,183,96,10,9,16,2,32,1,120,187,200,182,96,10,9,16,2,32,1,120,157,148,183,96,10,9,16,2,32,1,120,172,148,183,96,10,9,16,2,32,1,120,129,149,183,96,10,9,16,2,32,1,120,229,149,183,96,10,9,16,2,32,1,120,173,151,183,96,10,9,16,2,32,1,120,175,151,183,96,10,9,16,2,32,1,120,241,163,168,49,10,9,16,2,32,1,120,255,163,168,49,10,9,16,2,32,1,120,185,165,168,49,10,9,16,2,32,1,120,188,165,168,49,10,9,16,2,32,1,120,229,167,168,49,10,9,16,2,32,1,120,238,167,168,49,10,9,16,2,32,1,120,201,160,179,49,10,9,16,2,32,1,120,225,160,179,49,10,9,16,2,32,1,120,193,171,204,49,10,9,16,2,32,1,120,202,171,204,49,10,9,16,2,32,1,120,161,240,179,49,10,9,16,2,32,1,120,170,240,179,49,10,9,16,2,32,1,120,165,172,204,49,10,9,16,2,32,1,120,166,172,204,49,10,9,16,2,32,1,120,149,244,204,49,10,9,16,2,32,1,120,161,244,204,49,10,9,16,2,32,1,120,160,244,204,49,10,9,16,2,32,1,120,212,246,204,49,10,9,16,2,32,1,120,218,246,204,49,10,9,16,2,32,1,120,208,246,204,49,10,9,16,2,32,1,120,209,246,204,49,10,9,16,2,32,1,120,193,246,204,49,10,9,16,2,32,1,120,200,246,204,49,10,9,16,2,32,1,120,210,246,204,49,10,9,16,2,32,1,120,205,242,204,49,10,9,16,2,32,1,120,219,242,204,49,10,9,16,2,32,1,120,237,248,204,49,10,9,16,2,32,1,120,254,248,204,49,10,9,16,2,32,1,120,249,191,205,49,10,9,16,2,32,1,120,138,192,205,49,10,9,16,2,32,1,120,251,191,205,49,10,9,16,2,32,1,120,252,191,205,49,10,9,16,2,32,1,120,221,192,205,49,10,9,16,2,32,1,120,230,192,205,49,10,9,16,2,32,1,120,165,194,205,49,10,9,16,2,32,1,120,170,194,205,49,10,9,16,2,32,1,120,166,194,205,49,10,9,16,2,32,1,120,169,194,205,49,10,9,16,2,32,1,120,167,194,205,49,10,9,16,2,32,1,120,168,194,205,49,10,9,16,2,32,1,120,209,196,205,49,10,9,16,2,32,1,120,215,196,205,49,10,9,16,2,32,1,120,154,198,205,49,10,9,16,2,32,1,120,164,198,205,49,10,9,16,2,32,1,120,158,198,205,49,10,9,16,2,32,1,120,159,198,205,49,10,9,16,2,32,1,120,181,144,206,49,10,9,16,2,32,1,120,196,144,206,49,10,9,16,2,32,1,120,192,144,206,49,10,9,16,2,32,1,120,195,144,206,49,10,9,16,2,32,1,120,193,144,206,49,10,9,16,2,32,1,120,183,144,206,49,10,9,16,2,32,1,120,237,142,206,49,10,9,16,2,32,1,120,238,142,206,49,10,9,16,2,32,1,120,197,147,206,49,10,9,16,2,32,1,120,130,221,206,49,10,9,16,2,32,1,120,246,249,225,49,10,9,16,2,32,1,120,233,253,225,49,10,9,16,2,32,1,120,235,253,225,49,10,9,16,2,32,1,120,253,135,226,49,10,9,16,2,32,1,120,197,137,226,49,10,9,16,2,32,1,120,220,130,226,49,10,9,16,2,32,1,120,202,137,226,49,10,9,16,2,32,1,120,193,130,226,49,10,9,16,2,32,1,120,206,234,165,49,10,9,16,2,32,1,120,219,234,165,49,10,9,16,2,32,1,120,214,234,165,49,10,9,16,2,32,1,120,215,234,165,49,10,9,16,2,32,1,120,150,236,165,49,10,9,16,2,32,1,120,161,236,165,49,10,9,16,2,32,1,120,154,236,165,49,10,9,16,2,32,1,120,155,236,165,49,10,9,16,2,32,1,120,177,236,165,49,10,9,16,2,32,1,120,168,236,165,49,10,9,16,2,32,1,120,181,159,226,49,10,9,16,2,32,1,120,188,159,226,49,10,9,16,2,32,1,120,183,159,226,49,10,9,16,2,32,1,120,185,159,226,49,10,9,16,2,32,1,120,186,159,226,49,10,9,16,2,32,1,120,187,159,226,49,10,9,16,2,32,1,120,182,159,226,49,10,9,16,2,32,1,120,153,160,226,49,10,9,16,2,32,1,120,188,160,226,49,10,9,16,2,32,1,120,154,160,226,49,10,9,16,2,32,1,120,185,166,226,49,10,9,16,2,32,1,120,205,166,226,49,10,9,16,2,32,1,120,191,166,226,49,10,9,16,2,32,1,120,198,166,226,49,10,9,16,2,32,1,120,201,166,226,49,10,9,16,2,32,1,120,195,166,226,49,10,9,16,2,32,1,120,209,166,226,49,10,9,16,2,32,1,120,233,233,165,49,10,9,16,2,32,1,120,240,233,165,49,10,9,16,2,32,1,120,235,233,165,49,10,9,16,2,32,1,120,236,233,165,49,10,9,16,2,32,1,120,178,235,165,49,10,9,16,2,32,1,120,189,235,165,49,10,9,16,2,32,1,120,188,235,165,49,10,9,16,2,32,1,120,250,236,165,49,10,9,16,2,32,1,120,178,232,165,49,10,9,16,2,32,1,120,252,236,165,49,10,9,16,2,32,1,120,161,232,165,49,10,9,16,2,32,1,120,163,232,165,49,10,9,16,2,32,1,120,182,232,165,49,10,9,16,2,32,1,120,162,232,165,49,10,9,16,2,32,1,120,177,232,165,49,10,9,16,2,32,1,120,226,237,165,49,10,9,16,2,32,1,120,227,237,165,49,10,9,16,2,32,1,120,223,237,165,49,10,9,16,2,32,1,120,224,237,165,49,10,10,16,2,32,1,120,246,171,202,254,2,10,10,16,2,32,1,120,133,250,202,254,2,10,9,16,2,32,1,120,252,248,181,96,10,9,16,2,32,1,120,153,172,181,96,10,9,16,2,32,1,120,199,161,168,49,10,9,16,2,32,1,120,213,168,168,49,10,10,16,2,32,1,120,150,192,164,254,2,10,9,16,2,32,1,120,239,242,206,49,10,9,16,2,32,1,120,158,245,206,49,10,9,16,2,32,1,120,143,249,206,49,10,9,16,2,32,1,120,153,245,206,49,10,9,16,2,32,1,120,133,233,165,49,10,9,16,2,32,1,120,197,238,165,49,10,9,16,2,32,1,120,193,238,165,49,10,9,16,2,32,1,120,136,233,165,49,10,10,16,2,32,1,120,151,185,208,254,2,10,10,16,2,32,1,120,236,249,249,254,2,10,10,16,2,32,1,120,143,219,164,255,2,10,9,16,2,32,1,120,247,162,204,49,10,9,16,2,32,1,120,181,158,143,49,10,10,16,2,32,1,120,153,139,140,254,2,10,10,16,2,32,1,120,155,139,140,254,2,10,10,16,2,32,1,120,252,139,140,254,2,10,10,16,2,32,1,120,253,139,140,254,2,10,10,16,2,32,1,120,209,144,140,254,2,10,10,16,2,32,1,120,165,142,140,254,2,10,10,16,2,32,1,120,140,143,140,254,2,10,10,16,2,32,1,120,141,143,140,254,2,10,10,16,2,32,1,120,218,179,158,254,2,10,10,16,2,32,1,120,220,179,158,254,2,10,10,16,2,32,1,120,190,180,158,254,2,10,10,16,2,32,1,120,191,180,158,254,2,10,9,16,2,32,1,120,136,170,204,49,10,10,16,2,32,1,120,155,184,219,254,2,10,10,16,2,32,1,120,200,204,225,254,2,10,10,16,2,32,1,120,233,213,128,255,2,10,10,16,2,32,1,120,245,187,152,255,2,10,9,16,2,32,1,120,233,136,145,49,10,10,16,2,32,1,120,247,171,202,254,2,10,9,16,2,32,1,120,230,219,159,49,10,9,16,2,32,1,120,163,165,204,49,10,9,16,2,32,1,120,251,169,204,49,10,9,16,2,32,1,120,184,197,205,49,10,9,16,2,32,1,120,156,191,205,49,10,9,16,2,32,1,120,186,151,206,49,10,9,16,2,32,1,120,186,219,206,49,10,10,16,2,32,1,120,190,188,250,206,1,10,9,16,2,32,1,120,147,223,216,47,10,10,16,2,32,1,120,245,151,212,192,1,10,10,16,2,32,1,120,179,200,158,255,2,10,10,16,2,32,1,120,181,153,146,254,2,10,10,16,2,32,1,120,141,154,146,254,2,10,10,16,2,32,1,120,243,154,146,254,2,10,10,16,2,32,1,120,216,155,146,254,2,10,10,16,2,32,1,120,165,153,146,254,2,10,10,16,2,32,1,120,138,154,146,254,2,10,10,16,2,32,1,120,240,154,146,254,2,10,10,16,2,32,1,120,215,155,146,254,2,10,9,16,2,32,1,120,207,236,143,49,10,9,16,2,32,1,120,161,165,146,49,10,9,16,2,32,1,120,238,136,145,49,10,9,16,2,32,1,120,245,214,145,49,10,9,16,2,32,1,120,168,215,145,49,10,10,16,2,32,1,120,161,170,213,254,2,10,9,16,2,32,1,120,246,162,204,49,10,9,16,2,32,1,120,234,166,204,49,10,9,16,2,32,1,120,227,170,204,49,10,9,16,2,32,1,120,214,169,204,49,10,9,16,2,32,1,120,202,164,204,49,10,9,16,2,32,1,120,208,164,204,49,10,10,16,2,32,1,120,200,175,146,255,2,10,10,16,2,32,1,120,213,174,146,255,2,10,9,16,2,32,1,120,128,221,206,49,10,9,16,2,32,1,120,165,178,207,49,10,9,16,2,32,1,120,215,140,226,49,10,9,16,2,32,1,120,191,163,226,49,10,9,16,2,32,1,120,171,163,226,49,10,9,16,2,32,1,120,172,163,226,49,10,9,16,2,32,1,120,173,163,226,49,10,9,16,2,32,1,120,236,163,226,49,10,9,16,2,32,1,120,176,163,226,49,10,9,16,2,32,1,120,184,163,226,49,10,9,16,2,32,1,120,142,232,210,48,10,9,16,2,32,1,120,182,201,218,47,10,9,16,2,32,1,120,194,149,149,48,10,9,16,2,32,1,120,150,223,216,47,10,9,16,2,32,1,120,247,144,216,47,10,9,16,2,32,1,120,137,145,216,47,10,9,16,2,32,1,120,252,173,217,47,10,9,16,2,32,1,120,186,146,181,95,10,9,16,2,32,1,120,141,200,148,48,10,9,16,2,32,1,120,177,228,149,48,10,9,16,2,32,1,120,201,241,155,48,10,9,16,2,32,1,120,165,167,237,95,10,9,16,2,32,1,120,207,160,213,48,10,9,16,2,32,1,120,220,252,219,48,10,9,16,2,32,1,120,190,210,212,48,10,9,16,2,32,1,120,245,189,179,96,10,9,16,2,32,1,120,165,245,216,48,10,9,16,2,32,1,120,194,158,143,49,10,9,16,2,32,1,120,165,163,157,49,10,9,16,2,32,1,120,168,228,151,49,10,9,16,2,32,1,120,217,141,159,49,10,9,16,2,32,1,120,225,243,204,49,10,9,16,2,32,1,120,181,250,204,49,10,9,16,2,32,1,120,231,145,206,49,18,178,7,209,146,233,3,163,181,232,3,173,181,232,3,183,181,232,3,189,247,62,233,249,62,133,249,62,177,251,62,205,250,62,149,252,62,153,131,63,154,131,63,238,128,63,247,142,63,249,142,63,251,142,63,213,181,123,216,181,123,186,182,123,187,182,123,189,182,123,157,183,123,190,182,123,159,183,123,160,183,123,161,183,123,163,183,123,220,143,63,222,143,63,225,143,63,226,157,63,240,189,63,200,158,63,241,189,63,205,190,63,208,190,63,203,190,63,211,190,63,174,191,63,175,191,63,177,191,63,180,191,63,182,191,63,149,192,63,147,192,63,153,192,63,247,192,63,197,217,63,202,217,63,215,217,63,217,217,63,208,217,63,203,140,63,205,140,63,245,217,63,246,217,63,254,217,63,202,140,63,204,140,63,206,140,63,200,140,63,207,140,63,133,218,233,3,181,130,63,233,218,233,3,253,142,63,134,174,62,243,180,123,248,180,123,242,180,123,246,180,123,241,180,123,215,181,123,244,180,123,188,182,123,217,143,63,219,143,63,226,143,63,225,157,63,205,169,233,3,189,172,62,147,193,63,150,193,63,155,193,63,201,140,63,208,140,63,237,225,233,3,158,241,62,165,224,233,3,197,178,123,141,232,233,3,164,183,123,219,216,122,223,240,233,3,175,222,61,233,144,122,130,211,233,3,242,189,63,231,189,63,253,150,234,3,213,190,63,228,158,234,3,199,216,233,3,253,131,63,242,200,233,3,202,158,63,249,192,63,165,255,62,239,247,233,3,160,192,63,219,205,234,3,229,189,63,213,239,62,174,222,61,134,175,245,1,227,213,61,135,175,245,1,137,225,244,1,185,218,61,141,216,61,158,212,61,186,252,245,1,173,169,62,145,170,62,175,138,233,3,185,252,245,1,250,224,244,1,178,138,233,3,176,138,233,3,173,138,233,3,174,138,233,3,177,138,233,3,229,161,233,3,180,138,233,3,230,161,233,3,231,161,233,3,210,135,61,137,134,61,138,134,61,175,133,61,199,214,61,177,133,61,176,133,61,208,135,61,197,214,61,141,163,62,157,166,62,185,240,62,246,189,63,152,225,244,1,230,164,232,3,201,159,234,3,136,175,245,1,185,136,61,209,135,61,181,211,61,213,164,62,192,142,122,224,220,122,253,229,122,140,134,61,139,225,244,1,143,225,244,1,141,225,244,1,131,225,244,1,225,213,61,178,252,245,1,132,225,244,1,133,175,245,1,238,204,246,1,142,205,246,1,150,205,246,1,228,193,63,221,217,63,204,191,234,3,205,191,234,3,236,197,234,3,181,222,124,235,247,233,3,253,212,61,156,225,244,1,180,252,245,1,130,242,62,249,252,62,198,133,63,217,181,123,179,191,63,151,192,63,197,133,63,141,135,63,253,217,63,147,226,122,252,142,63,179,252,245,1,183,252,245,1,149,221,233,3,149,146,233,3,150,146,233,3,151,146,233,3,152,146,233,3,169,146,233,3,170,146,233,3,171,146,233,3,172,146,233,3,173,146,233,3,174,146,233,3,175,146,233,3,176,146,233,3,177,146,233,3,178,146,233,3,179,146,233,3,180,146,233,3,154,146,233,3,181,146,233,3,182,146,233,3,183,146,233,3,184,146,233,3,185,146,233,3,186,146,233,3,187,146,233,3,188,146,233,3,141,189,232,3,208,189,232,3,148,189,232,3,197,130,233,3,198,130,233,3,199,130,233,3,200,130,233,3,201,130,233,3,253,153,233,3,245,239,233,3,233,189,63,234,189,63,202,138,122,128,154,233,3,133,184,239,2,149,169,123,238,189,63,246,239,233,3,231,247,233,3,202,159,234,3,133,190,234,3,129,242,62,232,189,63,181,191,63,173,191,63,158,192,63,245,192,63,231,243,136,2,139,134,61,153,146,233,3,201,243,62,229,242,62,239,189,63,237,189,63,158,182,234,3,157,182,234,3,250,217,63,150,225,244,1,198,214,61,170,215,61,186,218,61,169,162,62,254,212,61,238,134,61,156,212,61,196,214,61,140,216,61,213,217,61,156,219,61,130,220,61,200,221,61,185,165,62,158,166,62,201,168,62,209,129,63,161,192,63,204,190,63,178,191,63,150,192,63,224,193,63,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,17,247,10,10,16,2,32,1,120,245,149,251,254,2,10,10,16,2,32,1,120,181,228,204,254,2,10,10,16,2,32,1,120,229,161,221,254,2,10,10,16,2,32,1,120,230,161,221,254,2,10,10,16,2,32,1,120,231,161,221,254,2,10,10,16,2,32,1,120,232,161,221,254,2,10,10,16,2,32,1,120,233,161,221,254,2,10,10,16,2,32,1,120,234,161,221,254,2,10,10,16,2,32,1,120,235,161,221,254,2,10,10,16,2,32,1,120,236,161,221,254,2,10,10,16,2,32,1,120,237,161,221,254,2,10,10,16,2,32,1,120,133,146,226,254,2,10,10,16,2,32,1,120,190,151,226,254,2,10,10,16,2,32,1,120,195,151,226,254,2,10,10,16,2,32,1,120,230,146,226,254,2,10,10,16,2,32,1,120,234,146,226,254,2,10,10,16,2,32,1,120,206,147,226,254,2,10,10,16,2,32,1,120,210,147,226,254,2,10,10,16,2,32,1,120,177,148,226,254,2,10,10,16,2,32,1,120,186,148,226,254,2,10,10,16,2,32,1,120,148,149,226,254,2,10,10,16,2,32,1,120,152,149,226,254,2,10,10,16,2,32,1,120,247,149,226,254,2,10,10,16,2,32,1,120,251,149,226,254,2,10,10,16,2,32,1,120,221,150,226,254,2,10,10,16,2,32,1,120,224,150,226,254,2,10,10,16,2,32,1,120,163,152,226,254,2,10,9,16,2,32,1,120,237,242,206,49,10,10,16,2,32,1,120,236,151,149,192,1,10,9,16,2,32,1,120,136,170,204,49,10,10,16,2,32,1,120,155,184,219,254,2,10,10,16,2,32,1,120,200,204,225,254,2,10,10,16,2,32,1,120,233,213,128,255,2,10,10,16,2,32,1,120,245,187,152,255,2,10,10,16,2,32,1,120,150,192,164,254,2,10,9,16,2,32,1,120,233,136,145,49,10,10,16,2,32,1,120,247,171,202,254,2,10,9,16,2,32,1,120,230,219,159,49,10,9,16,2,32,1,120,163,165,204,49,10,9,16,2,32,1,120,251,169,204,49,10,9,16,2,32,1,120,184,197,205,49,10,9,16,2,32,1,120,156,191,205,49,10,9,16,2,32,1,120,186,151,206,49,10,9,16,2,32,1,120,186,219,206,49,10,10,16,2,32,1,120,190,188,250,206,1,10,9,16,2,32,1,120,147,223,216,47,10,10,16,2,32,1,120,245,151,212,192,1,10,10,16,2,32,1,120,179,200,158,255,2,10,10,16,2,32,1,120,181,153,146,254,2,10,10,16,2,32,1,120,141,154,146,254,2,10,10,16,2,32,1,120,243,154,146,254,2,10,10,16,2,32,1,120,216,155,146,254,2,10,10,16,2,32,1,120,165,153,146,254,2,10,10,16,2,32,1,120,138,154,146,254,2,10,10,16,2,32,1,120,240,154,146,254,2,10,10,16,2,32,1,120,215,155,146,254,2,10,9,16,2,32,1,120,207,236,143,49,10,9,16,2,32,1,120,161,165,146,49,10,9,16,2,32,1,120,238,136,145,49,10,9,16,2,32,1,120,245,214,145,49,10,9,16,2,32,1,120,168,215,145,49,10,10,16,2,32,1,120,161,170,213,254,2,10,9,16,2,32,1,120,246,162,204,49,10,9,16,2,32,1,120,234,166,204,49,10,9,16,2,32,1,120,227,170,204,49,10,9,16,2,32,1,120,214,169,204,49,10,9,16,2,32,1,120,202,164,204,49,10,9,16,2,32,1,120,208,164,204,49,10,10,16,2,32,1,120,200,175,146,255,2,10,10,16,2,32,1,120,213,174,146,255,2,10,9,16,2,32,1,120,128,221,206,49,10,9,16,2,32,1,120,165,178,207,49,10,9,16,2,32,1,120,215,140,226,49,10,9,16,2,32,1,120,191,163,226,49,10,9,16,2,32,1,120,171,163,226,49,10,9,16,2,32,1,120,172,163,226,49,10,9,16,2,32,1,120,173,163,226,49,10,9,16,2,32,1,120,236,163,226,49,10,9,16,2,32,1,120,176,163,226,49,10,9,16,2,32,1,120,184,163,226,49,10,10,16,2,32,1,120,230,144,188,253,2,10,10,16,2,32,1,120,229,144,188,253,2,10,10,16,2,32,1,120,190,190,219,254,2,10,10,16,2,32,1,120,176,184,219,254,2,10,10,16,2,32,1,120,131,185,219,254,2,10,10,16,2,32,1,120,227,185,219,254,2,10,10,16,2,32,1,120,168,184,219,254,2,10,10,16,2,32,1,120,139,185,219,254,2,10,10,16,2,32,1,120,238,185,219,254,2,10,10,16,2,32,1,120,175,184,219,254,2,10,10,16,2,32,1,120,249,185,208,254,2,10,10,16,2,32,1,120,221,186,208,254,2,10,10,16,2,32,1,120,193,187,208,254,2,10,10,16,2,32,1,120,165,188,208,254,2,10,10,16,2,32,1,120,137,189,208,254,2,10,10,16,2,32,1,120,254,177,213,254,2,10,10,16,2,32,1,120,225,178,213,254,2,10,10,16,2,32,1,120,228,178,213,254,2,10,10,16,2,32,1,120,230,178,213,254,2,10,10,16,2,32,1,120,229,178,213,254,2,10,10,16,2,32,1,120,247,178,213,254,2,10,10,16,2,32,1,120,231,178,213,254,2,10,10,16,2,32,1,120,232,178,213,254,2,10,10,16,2,32,1,120,233,178,213,254,2,10,10,16,2,32,1,120,240,178,213,254,2,10,10,16,2,32,1,120,241,178,213,254,2,10,10,16,2,32,1,120,234,178,213,254,2,10,10,16,2,32,1,120,235,178,213,254,2,10,10,16,2,32,1,120,237,178,213,254,2,10,10,16,2,32,1,120,245,178,213,254,2,10,10,16,2,32,1,120,246,178,213,254,2,10,10,16,2,32,1,120,251,170,213,254,2,10,10,16,2,32,1,120,254,170,213,254,2,10,10,16,2,32,1,120,205,179,213,254,2,10,10,16,2,32,1,120,207,179,213,254,2,10,10,16,2,32,1,120,197,179,213,254,2,10,10,16,2,32,1,120,199,179,213,254,2,10,10,16,2,32,1,120,200,179,213,254,2,10,10,16,2,32,1,120,202,179,213,254,2,10,10,16,2,32,1,120,203,179,213,254,2,10,10,16,2,32,1,120,221,171,213,254,2,10,10,16,2,32,1,120,230,171,213,254,2,10,10,16,2,32,1,120,169,180,213,254,2,10,10,16,2,32,1,120,170,180,213,254,2,10,10,16,2,32,1,120,172,180,213,254,2,10,10,16,2,32,1,120,195,172,213,254,2,10,10,16,2,32,1,120,201,172,213,254,2,10,10,16,2,32,1,120,167,173,213,254,2,10,10,16,2,32,1,120,165,173,213,254,2,10,10,16,2,32,1,120,166,173,213,254,2,10,10,16,2,32,1,120,171,173,213,254,2,10,10,16,2,32,1,120,173,173,213,254,2,10,10,16,2,32,1,120,129,178,213,254,2,10,10,16,2,32,1,120,229,171,213,254,2,10,10,16,2,32,1,120,200,172,213,254,2,10,10,16,2,32,1,120,178,173,213,254,2,10,10,16,2,32,1,120,252,195,213,254,2,10,10,16,2,32,1,120,128,178,213,254,2,10,10,16,2,32,1,120,252,170,213,254,2,10,10,16,2,32,1,120,228,171,213,254,2,10,10,16,2,32,1,120,199,172,213,254,2,10,10,16,2,32,1,120,198,172,213,254,2,10,10,16,2,32,1,120,255,177,213,254,2,10,10,16,2,32,1,120,246,134,128,255,2,10,10,16,2,32,1,120,248,134,128,255,2,10,10,16,2,32,1,120,250,134,128,255,2,10,10,16,2,32,1,120,220,135,128,255,2,10,10,16,2,32,1,120,225,135,128,255,2,10,10,16,2,32,1,120,228,135,128,255,2,10,10,16,2,32,1,120,194,136,128,255,2,10,10,16,2,32,1,120,196,136,128,255,2,10,10,16,2,32,1,120,251,134,128,255,2,10,10,16,2,32,1,120,247,134,128,255,2,10,10,16,2,32,1,120,145,134,128,255,2,10,10,16,2,32,1,120,200,136,128,255,2,10,10,16,2,32,1,120,201,244,152,254,2,10,10,16,2,32,1,120,138,129,159,254,2,10,10,16,2,32,1,120,140,129,159,254,2,10,10,16,2,32,1,120,194,131,159,254,2,10,10,16,2,32,1,120,188,131,159,254,2,10,10,16,2,32,1,120,239,129,159,254,2,10,10,16,2,32,1,120,190,131,159,254,2,10,10,16,2,32,1,120,192,131,159,254,2,10,10,16,2,32,1,120,193,131,159,254,2,10,10,16,2,32,1,120,208,130,159,254,2,10,10,16,2,32,1,120,189,131,159,254,2,10,10,16,2,32,1,120,191,131,159,254,2,10,10,16,2,32,1,120,196,131,159,254,2,10,10,16,2,32,1,120,195,131,159,254,2,10,10,16,2,32,1,120,137,129,159,254,2,10,10,16,2,32,1,120,134,129,159,254,2,10,10,16,2,32,1,120,233,129,159,254,2,10,10,16,2,32,1,120,137,136,159,254,2,10,10,16,2,32,1,120,210,130,159,254,2,10,10,16,2,32,1,120,237,146,201,254,2,10,10,16,2,32,1,120,215,143,201,254,2,10,10,16,2,32,1,120,214,143,201,254,2,10,10,16,2,32,1,120,182,161,140,255,2,10,10,16,2,32,1,120,213,143,201,254,2,10,10,16,2,32,1,120,186,144,201,254,2,10,10,16,2,32,1,120,187,144,201,254,2,10,10,16,2,32,1,120,234,146,201,254,2,10,10,16,2,32,1,120,190,144,201,254,2,10,10,16,2,32,1,120,159,145,201,254,2,10,10,16,2,32,1,120,160,145,201,254,2,10,10,16,2,32,1,120,161,145,201,254,2,10,10,16,2,32,1,120,136,146,201,254,2,10,10,16,2,32,1,120,131,146,201,254,2,10,10,16,2,32,1,120,134,146,201,254,2,10,10,16,2,32,1,120,239,146,201,254,2,10,10,16,2,32,1,120,231,146,201,254,2,10,10,16,2,32,1,120,232,146,201,254,2,10,10,16,2,32,1,120,233,146,201,254,2,10,9,16,2,32,1,120,227,234,165,49,10,9,16,2,32,1,120,221,237,165,49,10,9,16,2,32,1,120,230,237,165,49,10,9,16,2,32,1,120,212,238,165,49,10,10,16,2,32,1,120,142,250,202,254,2,10,10,16,2,32,1,120,250,149,251,254,2,10,10,16,2,32,1,120,196,161,140,255,2,10,10,16,2,32,1,120,221,174,146,255,2,10,10,16,2,32,1,120,251,132,184,254,2,10,10,16,2,32,1,120,195,134,184,254,2,10,10,16,2,32,1,120,223,133,184,254,2,10,10,16,2,32,1,120,151,132,184,254,2,10,10,16,2,32,1,120,169,135,184,254,2,10,10,16,2,32,1,120,158,138,245,254,2,10,10,16,2,32,1,120,186,137,245,254,2,10,10,16,2,32,1,120,214,136,245,254,2,10,10,16,2,32,1,120,130,139,245,254,2,10,10,16,2,32,1,120,230,139,245,254,2,10,10,16,2,32,1,120,233,139,245,254,2,10,10,16,2,32,1,120,181,130,195,254,2,10,10,16,2,32,1,120,241,135,195,254,2,10,10,16,2,32,1,120,164,145,195,254,2,10,10,16,2,32,1,120,180,148,195,254,2,10,10,16,2,32,1,120,135,132,195,254,2,10,10,16,2,32,1,120,250,245,188,254,2,10,10,16,2,32,1,120,231,132,189,254,2,10,10,16,2,32,1,120,203,133,189,254,2,10,10,16,2,32,1,120,217,140,189,254,2,10,10,16,2,32,1,120,237,139,189,254,2,10,10,16,2,32,1,120,145,135,189,254,2,10,10,16,2,32,1,120,175,134,189,254,2,10,10,16,2,32,1,120,128,246,188,254,2,10,10,16,2,32,1,120,196,247,188,254,2,10,10,16,2,32,1,120,150,245,188,254,2,10,10,16,2,32,1,120,224,246,188,254,2,10,10,16,2,32,1,120,143,225,190,254,2,10,10,16,2,32,1,120,158,175,191,254,2,10,10,16,2,32,1,120,233,235,207,254,2,10,10,16,2,32,1,120,205,236,207,254,2,10,10,16,2,32,1,120,177,237,207,254,2,10,10,16,2,32,1,120,249,238,207,254,2,10,10,16,2,32,1,120,149,238,207,254,2,10,9,16,2,32,1,120,133,165,226,49,10,9,16,2,32,1,120,148,223,216,47,10,9,16,2,32,1,120,225,171,149,49,10,9,16,2,32,1,120,219,171,149,49,10,9,16,2,32,1,120,205,130,226,49,10,9,16,2,32,1,120,155,160,226,49,10,9,16,2,32,1,120,156,160,226,49,10,9,16,2,32,1,120,192,160,226,49,10,9,16,2,32,1,120,218,250,204,49,10,9,16,2,32,1,120,234,250,204,49,10,9,16,2,32,1,120,224,137,145,49,10,9,16,2,32,1,120,238,170,160,49,10,9,16,2,32,1,120,241,170,160,49,10,9,16,2,32,1,120,229,170,160,49,10,9,16,2,32,1,120,242,195,205,49,10,9,16,2,32,1,120,132,196,205,49,10,9,16,2,32,1,120,246,195,205,49,10,9,16,2,32,1,120,141,166,204,49,10,9,16,2,32,1,120,218,166,204,49,10,9,16,2,32,1,120,180,166,204,49,10,9,16,2,32,1,120,185,166,204,49,10,9,16,2,32,1,120,184,166,204,49,10,9,16,2,32,1,120,143,166,204,49,10,9,16,2,32,1,120,159,166,204,49,10,9,16,2,32,1,120,146,166,204,49,10,9,16,2,32,1,120,164,166,204,49,10,9,16,2,32,1,120,191,166,204,49,10,9,16,2,32,1,120,134,166,204,49,10,9,16,2,32,1,120,250,166,204,49,10,9,16,2,32,1,120,139,167,204,49,10,9,16,2,32,1,120,243,166,204,49,10,9,16,2,32,1,120,148,167,204,49,10,9,16,2,32,1,120,128,167,204,49,10,9,16,2,32,1,120,130,167,204,49,10,9,16,2,32,1,120,145,167,204,49,10,9,16,2,32,1,120,237,166,204,49,10,9,16,2,32,1,120,144,165,146,49,10,9,16,2,32,1,120,131,215,145,49,10,9,16,2,32,1,120,133,215,145,49,10,9,16,2,32,1,120,129,215,145,49,10,9,16,2,32,1,120,170,169,204,49,10,9,16,2,32,1,120,171,169,204,49,10,9,16,2,32,1,120,169,169,204,49,10,9,16,2,32,1,120,211,169,204,49,10,9,16,2,32,1,120,185,169,204,49,10,9,16,2,32,1,120,200,169,204,49,10,9,16,2,32,1,120,224,169,204,49,10,9,16,2,32,1,120,225,169,204,49,10,9,16,2,32,1,120,226,169,204,49,10,9,16,2,32,1,120,227,169,204,49,10,9,16,2,32,1,120,223,169,204,49,10,9,16,2,32,1,120,212,169,204,49,10,9,16,2,32,1,120,230,169,204,49,10,9,16,2,32,1,120,175,163,226,49,10,9,16,2,32,1,120,204,163,226,49,10,9,16,2,32,1,120,205,163,226,49,10,9,16,2,32,1,120,220,163,226,49,10,9,16,2,32,1,120,221,163,226,49,10,9,16,2,32,1,120,222,163,226,49,10,9,16,2,32,1,120,208,243,204,49,10,9,16,2,32,1,120,200,243,204,49,18,245,8,197,152,234,3,161,242,233,3,224,223,122,178,168,123,180,168,123,181,168,123,192,248,233,3,199,248,233,3,193,248,233,3,194,248,233,3,195,248,233,3,196,248,233,3,197,248,233,3,198,248,233,3,200,248,233,3,251,193,233,3,225,240,233,3,177,153,234,3,254,150,234,3,177,167,234,3,182,174,234,3,212,205,234,3,210,135,61,181,136,61,137,134,61,165,133,61,138,134,61,175,133,61,199,214,61,174,222,61,237,134,61,190,136,61,177,133,61,137,225,244,1,175,222,61,176,133,61,203,221,61,208,135,61,227,213,61,197,214,61,141,163,62,157,166,62,145,170,62,185,240,62,246,189,63,152,225,244,1,230,164,232,3,141,216,61,158,212,61,134,174,62,219,216,122,233,144,122,158,241,62,185,252,245,1,201,159,234,3,136,175,245,1,185,136,61,209,135,61,181,211,61,213,164,62,192,142,122,224,220,122,253,229,122,140,134,61,209,210,61,249,224,244,1,139,225,244,1,143,225,244,1,141,225,244,1,131,225,244,1,225,213,61,178,252,245,1,132,225,244,1,133,175,245,1,238,204,246,1,142,205,246,1,150,205,246,1,213,190,63,249,192,63,228,193,63,221,217,63,254,217,63,204,191,234,3,205,191,234,3,236,197,234,3,181,222,124,235,247,233,3,253,212,61,183,136,61,156,225,244,1,189,172,62,180,252,245,1,130,242,62,189,247,62,249,252,62,198,133,63,217,181,123,179,191,63,151,192,63,197,133,63,141,135,63,161,183,123,253,217,63,147,226,122,252,142,63,179,252,245,1,183,252,245,1,174,138,233,3,149,221,233,3,186,252,245,1,175,138,233,3,176,138,233,3,173,138,233,3,149,146,233,3,150,146,233,3,151,146,233,3,152,146,233,3,169,146,233,3,170,146,233,3,171,146,233,3,172,146,233,3,173,146,233,3,174,146,233,3,175,146,233,3,176,146,233,3,177,146,233,3,178,146,233,3,179,146,233,3,180,146,233,3,154,146,233,3,181,146,233,3,182,146,233,3,183,146,233,3,184,146,233,3,185,146,233,3,186,146,233,3,187,146,233,3,188,146,233,3,141,189,232,3,208,189,232,3,148,189,232,3,197,130,233,3,198,130,233,3,199,130,233,3,200,130,233,3,201,130,233,3,253,153,233,3,209,146,233,3,165,255,62,253,142,63,199,216,233,3,165,224,233,3,237,225,233,3,245,239,233,3,233,189,63,234,189,63,213,152,247,1,202,138,122,128,154,233,3,137,173,123,133,184,239,2,149,169,123,161,143,122,129,164,232,3,169,189,232,3,174,163,233,3,247,239,233,3,248,239,233,3,255,239,233,3,254,239,233,3,128,240,233,3,129,240,233,3,130,240,233,3,131,240,233,3,132,240,233,3,133,240,233,3,134,240,233,3,238,225,233,3,239,225,233,3,240,225,233,3,241,225,233,3,242,225,233,3,151,232,233,3,152,232,233,3,142,232,233,3,153,232,233,3,143,232,233,3,154,232,233,3,144,232,233,3,145,232,233,3,174,232,233,3,172,232,233,3,173,232,233,3,175,232,233,3,176,232,233,3,177,232,233,3,178,232,233,3,179,232,233,3,229,158,234,3,230,158,234,3,231,158,234,3,205,220,122,212,220,122,226,154,233,3,202,162,233,3,203,162,233,3,201,162,233,3,204,162,233,3,210,162,233,3,193,216,233,3,189,216,233,3,181,174,234,3,190,216,233,3,191,216,233,3,192,216,233,3,158,219,61,229,220,61,214,217,61,245,142,63,248,142,63,157,241,62,159,241,62,173,244,62,174,244,62,145,245,62,245,245,62,217,246,62,218,246,62,161,248,62,193,254,62,237,128,63,225,132,63,254,131,63,255,131,63,128,132,63,169,134,63,254,142,63,239,220,122,173,163,233,3,204,194,233,3,189,142,122,239,173,232,3,180,180,232,3,215,154,233,3,181,202,233,3,236,200,233,3,209,201,233,3,185,209,233,3,213,208,233,3,158,210,233,3,137,225,233,3,241,232,233,3,201,248,233,3,217,240,233,3,189,241,233,3,149,143,234,3,220,144,234,3,175,153,234,3,169,153,234,3,173,160,234,3,205,166,234,3,161,182,234,3,153,175,234,3,128,183,234,3,229,183,234,3,136,190,234,3,232,190,234,3,210,198,234,3,209,198,234,3,187,206,234,3,220,205,234,3,206,194,233,3,208,194,233,3,207,194,233,3,205,194,233,3,209,194,233,3,223,144,234,3,222,144,234,3,221,144,234,3,224,144,234,3,225,144,234,3,216,208,233,3,222,208,233,3,223,208,233,3,224,208,233,3,225,208,233,3,226,208,233,3,227,208,233,3,220,208,233,3,232,208,233,3,236,208,233,3,215,208,233,3,238,200,233,3,129,201,233,3,130,201,233,3,139,201,233,3,138,201,233,3,132,201,233,3,131,201,233,3,240,200,233,3,237,200,233,3,239,200,233,3,155,203,233,3,255,203,233,3,138,225,233,3,139,225,233,3,140,225,233,3,142,225,233,3,141,225,233,3,252,217,63,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,0,11,10,9,16,2,32,1,120,158,243,146,49,215,161,82,200),
    [byte[]]@(157,116,199,20,4,238,0,0,0,0,0,11,10,9,16,2,32,1,120,133,146,181,95,215,161,82,200)
)

function Get-NextMissionStatusBytes {
    $arr = $MissionStatusResponses
    if ($arr.Count -eq 0) {
        return [byte[]]@()
    }
    $i = $global:MissionStatusIndex
    $bytes = $arr[$i]
    $global:MissionStatusIndex = ($i + 1) % $arr.Count
    return $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.GetMissionStatusCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = Get-NextMissionStatusBytes
    Write-RawResponse $ctx $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.PlayerGetTokenCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,0,11,0,0,0,0,0,2,24,1,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.PlayerHeartBeatCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,0,79,0,0,0,0,0,14,16,176,204,253,167,168,51,32,199,204,253,167,168,51,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.PlayerLoginCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,0,9,0,0,0,0,0,27,48,173,145,253,167,168,51,64,240,1,74,15,10,6,121,117,108,105,97,110,16,61,32,240,1,64,5,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$HandlerMap[[uint16](Get-FieldNum "CmdId.GetCurSceneInfoCsReq")] = {
    param([pscustomobject] $ctx)

    $bytes = [byte[]]@(157,116,199,20,5,140,0,0,0,0,0,98,98,96,8,2,16,217,158,1,48,169,231,215,9,64,197,253,123,194,62,33,50,29,18,16,26,0,98,12,40,228,206,53,112,216,252,4,120,230,196,23,90,9,8,3,32,246,7,48,1,112,2,104,1,194,62,42,50,35,18,16,26,0,98,12,40,252,249,52,112,160,235,3,120,232,196,23,24,185,10,96,186,1,120,225,167,18,58,5,56,168,6,96,1,104,1,120,186,1,215,161,82,200)
    Write-RawResponse $ctx $bytes
}

$gameserver = [TcpListener]::new(
    [IPAddress]::Parse("127.0.0.1"),
    23301
)
$gameserver.Start()
Write-Host "gameserver @ localhost:23301"

while ($true) {
    $client = $gameserver.AcceptTcpClient()
    Write-Host "new client:" $client.Client.RemoteEndPoint
    try {
        $stream = $client.GetStream()
        while ($true) {
            $packet = $null
            if (-not $client.Connected -or -not $stream.CanRead) {
                break
            }
            try {
                $packet = [Packet]::read_packet($stream)
            }
            catch {
                Write-Host "error reading packet: $($_.Exception.Message)"
                break
            }
            if ($null -eq $packet) { break }
            Write-Host "got cmd" $packet.cmd
            if ($DummyMap.ContainsKey($packet.cmd)) {
                $rsp_cmd = $DummyMap[$packet.cmd]
                $packet = [Packet]::new([uint16]$rsp_cmd, [byte[]]@(), [byte[]]@())
                $encoded = $packet.encode()
                $stream.Write($encoded, 0, $encoded.Length)
                Write-Host "dummy'd" $packet.cmd
                continue
            }
            if ($HandlerMap.ContainsKey($packet.cmd)) {
                Write-Host "handled" $packet.cmd
                $HandlerMap[$packet.cmd].Invoke([pscustomobject]@{
                        client = $client
                        stream = $stream
                        packet = $packet
                    })
                continue
            }
            Write-Host "ignored" $packet.cmd
        }
    }
    finally {
        Write-Host "client disconnected"
    }
}
